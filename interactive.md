
# 扩展交互功能

## 交互类型

交互分为两大类：
1. **事件交互**
2. **数据交互**

### 1. 事件交互
事件交互是通过用户操作触发的交互事件，例如点击、悬浮等，系统通过监听和响应这些事件来执行对应的逻辑。

目前支持的事件交互类型包括：
- **点击事件**：监听组件或元素的点击操作。
- **悬浮事件**：监听用户鼠标悬浮到某个组件或元素时的事件。
- **数据初始化事件**：在组件或页面加载时触发，用于初始化数据或状态。

### 2. 数据交互
数据交互是指不同组件或模块之间通过数据传递和共享来进行交互，例如一个组件的状态变化会影响到其他组件的数据或行为。数据交互的方式通常依赖于状态管理、API 调用等。

## 交互作用对象

交互的作用对象可以分为两类：
1. **普通组件**：常规的 UI 组件，如按钮、选项卡、文本等。
2. **3D 地球组件（`xt-earth`）**：专门用于渲染 3D 地球的组件，支持倾斜摄影、点位等的交互。

## 交互逻辑

交互逻辑的实现集中在 `packages\shared\src\interaction-management` 目录下。该目录包含了与交互相关的核心逻辑文件，具体文件功能如下：

1. **事件入口文件 `index.ts`**  
   该文件是事件交互的入口，主要用来注册有哪些事件。

2. **动画管理文件 `animation-manage.ts`**  
   该文件用于管理动画效果的执行，包括动画的触发、暂停、结束等。

3. **地图管理文件 `map-manage.ts`**  
   该文件负责与地图相关的交互管理，主要用于处理 3D 地球（`xt-earth`）组件上的事件响应，如地图缩放、拖动等。

4. **交互执行文件 `perform-handle.ts`**  
   该文件负责执行交互相关的具体操作逻辑，处理事件触发后的具体行为。

### 使用 `mitt` 事件总线

在事件交互方面，我们使用了 `mitt` 作为事件总线。`mitt` 是一个非常轻量级的事件管理库，它简洁、易用，适合在项目中快速处理事件流和事件监听。

#### 事件交互的基本流程：

- 通过 `mitt` 创建一个事件总线来管理数据的传递。
- 在各个组件中触发事件，将事件和事件数据通过 `mitt` 发布到总线上。
- 其他组件或模块通过订阅（`on`）事件总线来监听特定的事件，并在事件触发时执行相应的操作。

```ts
// 引入 mitt
import mitt from 'mitt';

// 创建事件总线
const emitter = mitt();

// 触发事件
emitter.emit('eventName', eventData);

// 监听事件
emitter.on('eventName', (data) => {
  console.log('事件触发，数据：', data);
});
```

通过 `mitt`，你可以灵活地进行事件通信，而不需要手动管理大量的回调函数。事件可以跨越多个组件或模块传递，提升了系统的可扩展性和维护性。


## 扩展交互功能

如果你需要扩展交互功能，可以按照以下步骤进行：

### 1. 在 `perform-handle.ts` 中注册和添加交互执行逻辑

如果你的扩展涉及到具体的交互行为（例如点击时触发动画、数据更新等），请在 `packages/shared/src/perform-handle.ts` 文件中添加相应的判断和执行逻辑。

例如，如果你需要添加一个自定义事件的处理逻辑：
在 `setHandleList` 方法的`switch`中添加对应的判断逻辑，进行事件的注册


### 2. 新建模块文件

如果扩展的交互功能比较复杂，建议将相关的逻辑分离到独立的模块文件中，并在 `perform-handle.ts` 中引入。这样做有助于提高代码的可维护性和复用性。

例如，你可以新建一个 `new-interaction.ts` 文件，定义新的交互行为：

```ts
// new-interaction.ts
class NewInteraction {
    start(){
        // 执行新的交互逻辑
    }
}
```

然后在 `perform-handle.ts` 中引入并调用该模块：
```ts
import { NewInteraction } from './new-interaction';

// 执行新的交互逻辑
new NewInteraction(data);
```

## xt-earth 组件简介
[`xt-earth`](https://xtspace.yuque.com/otnc49/cyga58/szafiz) 是我们基于 Cesium 进行二次封装的 3D 地球组件，它提供了更简化的 API，使得用户可以更轻松地进行地理位置管理、标记等操作。通过该组件，你可以方便地进行与 3D 地图相关的交互。

## 小结

通过上述步骤，你可以轻松扩展现有的交互功能。交互扩展的关键是合理利用 `mitt` 事件总线来监听数据的变化，并在需要的地方新增或修改具体的交互行为逻辑。如果遇到更复杂的交互需求，可以将其拆分成多个独立的模块，保持代码的清晰和可维护性。

如有任何问题或需要进一步的帮助，请随时联系我们！

